<!doctype html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Dashboard - YouTube Bot</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              yt: {
                bg: "#f3f4f6" /* Cinza claro */,
                card: "#ffffff" /* Branco */,
                text: "#1f2937" /* Cinza escuro */,
                red: "#cc0000",
              },
            },
          },
        },
      };
    </script>
  </head>
  <body class="bg-yt-bg text-yt-text font-sans overflow-hidden">
    <div class="flex h-screen">
      <!-- Sidebar -->
      <aside
        id="sidebar"
        class="w-64 bg-yt-card border-r border-gray-200 flex flex-col fixed md:relative z-50 h-full transition-transform transform -translate-x-full md:translate-x-0 shadow-2xl md:shadow-none"
      >
        <div class="p-6 text-xl font-bold flex items-center gap-2">
          <span class="text-red-600">‚ñ∂</span> Painel
        </div>
        <nav class="flex-1 px-4 space-y-2">
          <a
            href="/app"
            class="block px-4 py-3 rounded-lg bg-red-600 text-white font-medium"
            >üì∫ Dashboard</a
          >
          <a
            href="/plans"
            class="block px-4 py-3 rounded-lg hover:bg-gray-100 transition"
            >üíé Planos</a
          >
          <a
            href="/tips"
            class="block px-4 py-3 rounded-lg hover:bg-gray-100 transition"
            >üí° Dicas</a
          >
          <a
            href="/profile"
            class="block px-4 py-3 rounded-lg hover:bg-gray-100 transition"
            >üë§ Perfil</a
          >
        </nav>
        <div class="p-4 border-t border-gray-200">
          <button
            onclick="logout()"
            class="w-full py-2 text-gray-400 hover:text-white text-sm"
          >
            Sair da Conta
          </button>
        </div>
      </aside>

      <!-- Main Content -->
      <main
        class="flex-1 flex flex-col h-screen overflow-hidden relative w-full bg-yt-bg"
      >
        <!-- Overlay para mobile quando sidebar aberta -->
        <div
          id="sidebarOverlay"
          class="fixed inset-0 bg-black/50 z-40 hidden md:hidden glass"
        ></div>

        <!-- Topbar -->
        <header
          class="h-16 bg-yt-card border-b border-gray-200 flex items-center justify-between px-6"
        >
          <button id="menuToggle" class="md:hidden text-2xl">‚ò∞</button>
          <div class="flex items-center gap-4">
            <span id="planStatus" class="text-sm font-bold text-green-500"
              >Carregando...</span
            >
            <a
              href="/plans"
              id="upgradeBtn"
              class="hidden text-xs bg-yellow-600 text-white px-2 py-1 rounded"
              >UPGRADE</a
            >
          </div>
        </header>

        <!-- Content Scrollable -->
        <div class="flex-1 overflow-y-auto p-6">
          <!-- Status Cards -->
          <div class="grid md:grid-cols-2 gap-6 mb-8">
            <div
              class="p-6 bg-yt-card rounded-xl border border-gray-200 shadow-sm"
            >
              <h3 class="font-bold mb-2">Conex√£o YouTube</h3>
              <div id="ytConnectionStatus">
                <p class="text-yellow-500 text-sm mb-3">
                  ‚ö†Ô∏è Canal n√£o conectado
                </p>
                <button
                  onclick="connectYoutube()"
                  class="px-4 py-2 bg-red-600 text-white rounded text-sm font-bold"
                >
                  Conectar Agora
                </button>
              </div>
              <div id="ytConnected" class="hidden">
                <p class="text-green-500 font-bold">‚úÖ Canal Conectado</p>
              </div>
            </div>
          </div>

          <!-- Bot Interface (Hidden until connected) -->
          <div id="botArea" class="hidden grid lg:grid-cols-3 gap-8">
            <!-- Left: Video Feed -->
            <div class="lg:col-span-2">
              <div
                class="flex flex-col sm:flex-row justify-between items-center mb-6 gap-4"
              >
                <h2 class="text-xl font-bold flex items-center gap-2">
                  Feed de V√≠deos
                  <button
                    onclick="loadRecentVideos()"
                    class="text-sm p-1.5 bg-gray-800 rounded-full hover:bg-gray-700"
                    title="Atualizar"
                  >
                    üîÑ
                  </button>
                </h2>

                <!-- Barra de Pesquisa de Canais -->
                <div class="flex w-full sm:w-auto gap-2">
                  <input
                    type="text"
                    id="channelSearchInput"
                    placeholder="Buscar canal..."
                    class="w-full sm:w-48 p-2 bg-gray-50 border border-gray-300 rounded text-sm text-gray-800 focus:border-red-600 outline-none"
                  />
                  <button
                    onclick="searchChannels()"
                    class="p-2 bg-gray-200 hover:bg-gray-300 rounded text-gray-700"
                  >
                    üîç
                  </button>
                  <button
                    id="clearFilterBtn"
                    onclick="clearFilter()"
                    class="hidden p-2 bg-red-100 hover:bg-red-200 text-red-700 rounded text-xs"
                  >
                    ‚ùå
                  </button>
                </div>
              </div>

              <!-- Resultados da Pesquisa de Canais -->
              <div
                id="channelSearchResults"
                class="hidden flex-wrap gap-3 mb-4 p-3 bg-white rounded-lg border border-gray-200"
              >
                <!-- Injetado via JS -->
              </div>

              <div id="listTitle" class="text-sm text-gray-400 mb-2 hidden">
                Mostrando resultados filtrados
              </div>
              <div
                id="recentVideos"
                class="grid grid-cols-2 md:grid-cols-3 gap-4"
              >
                <!-- Videos injected by JS -->
              </div>
              <div class="text-center mt-6">
                <button
                  id="loadMoreBtn"
                  onclick="loadRecentVideos(currentNextPageToken, true)"
                  class="hidden px-6 py-2 bg-gray-200 text-gray-800 hover:bg-gray-300 rounded-full text-sm"
                >
                  Carregar Mais
                </button>
              </div>
            </div>

            <!-- Right: Action Form -->
            <div class="lg:col-span-1">
              <div
                class="bg-yt-card p-6 rounded-xl border border-gray-200 shadow-sm sticky top-6"
              >
                <h3 class="font-bold mb-4">Painel de A√ß√£o</h3>
                <form id="botForm" class="space-y-4">
                  <div>
                    <label class="text-xs text-gray-500 uppercase font-bold"
                      >ID do V√≠deo</label
                    >
                    <input
                      type="text"
                      name="video_id"
                      id="video_id"
                      class="w-full p-2 bg-gray-50 border border-gray-300 rounded text-gray-800"
                      placeholder="Ex: dQw4w9WgXcQ"
                      required
                    />
                  </div>

                  <div
                    id="videoPreview"
                    class="hidden bg-black p-2 rounded text-center"
                  >
                    <img id="thumb" src="" class="w-full rounded mb-2" />
                    <p id="vidTitle" class="text-xs font-bold truncate"></p>
                    <p id="vidChannel" class="text-[10px] text-gray-400"></p>
                  </div>

                  <div>
                    <label class="text-xs text-gray-500 uppercase font-bold"
                      >Tipo</label
                    >
                    <select
                      name="type"
                      class="w-full p-2 bg-gray-50 border border-gray-300 rounded text-gray-800"
                    >
                      <option value="live">Chat ao Vivo (Live)</option>
                      <option value="comment">Coment√°rio</option>
                    </select>
                  </div>

                  <div>
                    <label class="text-xs text-gray-500 uppercase font-bold"
                      >Mensagem</label
                    >
                    <textarea
                      name="message"
                      rows="3"
                      class="w-full p-2 bg-gray-50 border border-gray-300 rounded text-gray-800"
                      required
                    ></textarea>
                  </div>

                  <div class="bg-gray-50 p-3 rounded border border-gray-200">
                    <label
                      class="flex items-center gap-2 text-sm cursor-pointer"
                    >
                      <input type="checkbox" id="autoMode" />
                      <span>üîÑ Modo Autom√°tico</span>
                    </label>
                    <div
                      id="autoOptions"
                      class="hidden mt-3 grid grid-cols-2 gap-2"
                    >
                      <div>
                        <label class="text-[10px]">Repeti√ß√µes</label>
                        <input
                          type="number"
                          id="repeatCount"
                          value="5"
                          class="w-full p-1 bg-white border border-gray-300 rounded text-gray-800"
                        />
                      </div>
                      <div>
                        <label class="text-[10px]">Intervalo (s)</label>
                        <input
                          type="number"
                          id="repeatInterval"
                          value="60"
                          class="w-full p-1 bg-white border border-gray-300 rounded text-gray-800"
                        />
                      </div>
                    </div>
                  </div>

                  <button
                    type="submit"
                    id="btnSubmit"
                    class="w-full py-3 bg-yt-red hover:bg-red-700 text-white font-bold rounded-lg transition"
                  >
                    Enviar
                  </button>
                </form>
                <div id="result" class="hidden"></div>
              </div>
            </div>
          </div>
        </div>
      </main>
    </div>

    <!-- ONBOARDING MODAL -->
    <div
      id="onboardingModal"
      class="fixed inset-0 z-[100] hidden flex items-center justify-center bg-black/60 backdrop-blur-sm"
    >
      <div
        class="bg-white text-gray-900 rounded-2xl shadow-2xl max-w-2xl w-full mx-4 overflow-hidden"
      >
        <div class="bg-red-600 p-6 text-white text-center">
          <h2 class="text-2xl font-bold">Bem-vindo ao YouTube Bot! üöÄ</h2>
          <p class="text-red-100">Seu assistente pessoal para engajamento.</p>
        </div>
        <div class="p-8 space-y-6">
          <div class="grid md:grid-cols-2 gap-6">
            <div class="space-y-2">
              <h3 class="font-bold text-lg">Como usar:</h3>
              <ul class="list-disc pl-5 text-sm text-gray-600 space-y-1">
                <li>Conecte seu canal no bot√£o vermelho.</li>
                <li>Veja os v√≠deos recentes das suas inscri√ß√µes.</li>
                <li>Clique em um v√≠deo para carregar o ID.</li>
                <li>Escreva sua mensagem e envie!</li>
              </ul>
            </div>
            <div class="bg-gray-50 p-4 rounded-lg border border-gray-200">
              <h3 class="font-bold text-lg mb-2">Dica PRO üíé</h3>
              <p class="text-sm text-gray-600">
                Usu√°rios PRO podem ativar o
                <strong>Modo Autom√°tico</strong> para enviar mensagens repetidas
                em Lives ou comentar em v√°rios v√≠deos sem parar.
              </p>
              <a
                href="/plans"
                class="block mt-3 text-center text-xs font-bold text-red-600 hover:underline"
                >VER PLANOS</a
              >
            </div>
          </div>

          <div class="text-center pt-4">
            <button
              onclick="closeOnboarding()"
              class="px-8 py-3 bg-gray-900 text-white rounded-full font-bold hover:bg-gray-800 transition"
            >
              Entendi, vamos come√ßar!
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- NOTIFICA√á√ÉO DE CR√âDITOS BAIXOS -->
    <div
      id="creditNotification"
      class="fixed bottom-5 right-5 z-50 hidden bg-white border-l-4 border-yellow-500 shadow-xl rounded-r-lg p-4 max-w-sm transition-all duration-500 transform translate-y-0"
    >
      <div class="flex items-start">
        <div class="flex-shrink-0 text-yellow-500">
          <span class="text-2xl">‚ö†Ô∏è</span>
        </div>
        <div class="ml-3">
          <h3 class="text-sm font-medium text-gray-900">Cr√©ditos acabando!</h3>
          <div class="mt-1 text-sm text-gray-500">
            Restam apenas
            <span id="creditCountDisplay" class="font-bold text-red-600"
              >0</span
            >
            cr√©ditos.
          </div>
          <div class="mt-3 flex space-x-4">
            <a
              href="/plans"
              class="text-sm font-bold text-yellow-600 hover:text-yellow-500"
              >Fazer Upgrade</a
            >
            <button
              onclick="
                document
                  .getElementById('creditNotification')
                  .classList.add('hidden')
              "
              class="text-sm text-gray-500 hover:text-gray-400"
            >
              Fechar
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Scripts -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

    <!-- Importando arquivos JS externos -->
    <script src="/static/js/firebase-config.js"></script>
    <script src="/static/js/dashboard.js"></script>
  </body>
</html>
